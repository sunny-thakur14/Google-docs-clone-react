{"ast":null,"code":"import _slicedToArray from\"C:/Users/Sunny/Desktop/Google_doc_clone_react/client/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import{useCallback,useEffect,useState}from\"react\";import Quill from\"quill\";import\"quill/dist/quill.snow.css\";import{io}from\"socket.io-client\";import{useParams}from\"react-router-dom\";import{jsx as _jsx}from\"react/jsx-runtime\";var SAVE_INTERVAL_MS=2000;var TOOLBAR_OPTIONS=[[{header:[1,2,3,4,5,6,false]}],[{font:[]}],[{list:\"ordered\"},{list:\"bullet\"}],[\"bold\",\"italic\",\"underline\"],[{color:[]},{background:[]}],[{script:\"sub\"},{script:\"super\"}],[{align:[]}],[\"image\",\"blockquote\",\"code-block\"],[\"clean\"]];export default function TextEditor(){var _useParams=useParams(),documentId=_useParams.id;var _useState=useState(),_useState2=_slicedToArray(_useState,2),socket=_useState2[0],setSocket=_useState2[1];var _useState3=useState(),_useState4=_slicedToArray(_useState3,2),quill=_useState4[0],setQuill=_useState4[1];useEffect(function(){var s=io(\"http://localhost:4000\");setSocket(s);return function(){s.disconnect();};},[]);useEffect(function(){if(socket==null||quill==null)return;socket.once(\"load-document\",function(document){quill.setContents(document);quill.enable();});socket.emit(\"get-document\",documentId);},[socket,quill,documentId]);useEffect(function(){if(socket==null||quill==null)return;var interval=setInterval(function(){socket.emit(\"save-document\",quill.getContents());},SAVE_INTERVAL_MS);return function(){clearInterval(interval);};},[socket,quill]);useEffect(function(){if(socket==null||quill==null)return;var handler=function handler(delta){quill.updateContents(delta);};socket.on(\"receive-changes\",handler);return function(){socket.off(\"receive-changes\",handler);};},[socket,quill]);useEffect(function(){if(socket==null||quill==null)return;var handler=function handler(delta,oldDelta,source){if(source!==\"user\")return;socket.emit(\"send-changes\",delta);};quill.on(\"text-change\",handler);return function(){quill.off(\"text-change\",handler);};},[socket,quill]);var wrapperRef=useCallback(function(wrapper){if(wrapper==null)return;wrapper.innerHTML=\"\";var editor=document.createElement(\"div\");wrapper.append(editor);var q=new Quill(editor,{theme:\"snow\",modules:{toolbar:TOOLBAR_OPTIONS}});q.disable();q.setText(\"Loading...\");setQuill(q);},[]);return/*#__PURE__*/_jsx(\"div\",{className:\"mybox\",ref:wrapperRef});}","map":{"version":3,"names":["useCallback","useEffect","useState","Quill","io","useParams","jsx","_jsx","SAVE_INTERVAL_MS","TOOLBAR_OPTIONS","header","font","list","color","background","script","align","TextEditor","_useParams","documentId","id","_useState","_useState2","_slicedToArray","socket","setSocket","_useState3","_useState4","quill","setQuill","s","disconnect","once","document","setContents","enable","emit","interval","setInterval","getContents","clearInterval","handler","delta","updateContents","on","off","oldDelta","source","wrapperRef","wrapper","innerHTML","editor","createElement","append","q","theme","modules","toolbar","disable","setText","className","ref"],"sources":["C:/Users/Sunny/Desktop/Google_doc_clone_react/client/src/MyTextEditor.js"],"sourcesContent":["import { useCallback, useEffect, useState } from \"react\";\r\nimport Quill from \"quill\";\r\nimport \"quill/dist/quill.snow.css\";\r\nimport { io } from \"socket.io-client\";\r\nimport { useParams } from \"react-router-dom\";\r\n\r\nconst SAVE_INTERVAL_MS = 2000;\r\nconst TOOLBAR_OPTIONS = [\r\n  [{ header: [1, 2, 3, 4, 5, 6, false] }],\r\n  [{ font: [] }],\r\n  [{ list: \"ordered\" }, { list: \"bullet\" }],\r\n  [\"bold\", \"italic\", \"underline\"],\r\n  [{ color: [] }, { background: [] }],\r\n  [{ script: \"sub\" }, { script: \"super\" }],\r\n  [{ align: [] }],\r\n  [\"image\", \"blockquote\", \"code-block\"],\r\n  [\"clean\"],\r\n];\r\n\r\nexport default function TextEditor() {\r\n  const { id: documentId } = useParams();\r\n  const [socket, setSocket] = useState();\r\n  const [quill, setQuill] = useState();\r\n\r\n  useEffect(() => {\r\n    const s = io(\"http://localhost:4000\");\r\n    setSocket(s);\r\n\r\n    return () => {\r\n      s.disconnect();\r\n    };\r\n  }, []);\r\n\r\n  useEffect(() => {\r\n    if (socket == null || quill == null) return;\r\n\r\n    socket.once(\"load-document\", (document) => {\r\n      quill.setContents(document);\r\n      quill.enable();\r\n    });\r\n\r\n    socket.emit(\"get-document\", documentId);\r\n  }, [socket, quill, documentId]);\r\n\r\n  useEffect(() => {\r\n    if (socket == null || quill == null) return;\r\n\r\n    const interval = setInterval(() => {\r\n      socket.emit(\"save-document\", quill.getContents());\r\n    }, SAVE_INTERVAL_MS);\r\n\r\n    return () => {\r\n      clearInterval(interval);\r\n    };\r\n  }, [socket, quill]);\r\n\r\n  useEffect(() => {\r\n    if (socket == null || quill == null) return;\r\n\r\n    const handler = (delta) => {\r\n      quill.updateContents(delta);\r\n    };\r\n    socket.on(\"receive-changes\", handler);\r\n\r\n    return () => {\r\n      socket.off(\"receive-changes\", handler);\r\n    };\r\n  }, [socket, quill]);\r\n\r\n  useEffect(() => {\r\n    if (socket == null || quill == null) return;\r\n\r\n    const handler = (delta, oldDelta, source) => {\r\n      if (source !== \"user\") return;\r\n      socket.emit(\"send-changes\", delta);\r\n    };\r\n    quill.on(\"text-change\", handler);\r\n\r\n    return () => {\r\n      quill.off(\"text-change\", handler);\r\n    };\r\n  }, [socket, quill]);\r\n\r\n  const wrapperRef = useCallback((wrapper) => {\r\n    if (wrapper == null) return;\r\n\r\n    wrapper.innerHTML = \"\";\r\n    const editor = document.createElement(\"div\");\r\n    wrapper.append(editor);\r\n    const q = new Quill(editor, {\r\n      theme: \"snow\",\r\n      modules: { toolbar: TOOLBAR_OPTIONS },\r\n    });\r\n    q.disable();\r\n    q.setText(\"Loading...\");\r\n    setQuill(q);\r\n  }, []);\r\n  return <div className=\"mybox\" ref={wrapperRef}></div>;\r\n}\r\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}